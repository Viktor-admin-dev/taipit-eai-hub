# Taipit EAI Hub

Внутренний портал холдинга Тайпит для конкурса идей по внедрению Enterprise AI. Сотрудники подают заявки, голосуют, читают истории коллег. Администратор управляет заявками и смотрит аналитику.

**Продакшен:** https://taipit.starec.ai
**Сервер:** Hetzner 136.243.71.213 (Docker, порт 3010)

## Стек технологий

- **Next.js 16.1.6** (React 19, TypeScript, App Router)
- **Prisma ORM** + SQLite
- **TailwindCSS 4** (тёмная тема)
- **Recharts** (графики в админке)
- **JWT** (авторизация админа + форум-сотрудников)
- **Docker** (продакшен-деплой)

## Структура проекта

```
src/
├── app/
│   ├── page.tsx                    # Главная (карусель, статистика, CTA)
│   ├── why/page.tsx                # Зачем конкурс (письмо акционера, бенефиты)
│   ├── testimonials/page.tsx       # Истории успеха (4 кейса из 55-го дивизиона)
│   ├── contest/page.tsx            # Конкурс (этапы, призы, условия, форма заявки)
│   ├── how-to-participate/page.tsx # Как участвовать (воронка, тьюторы, FAQ)
│   ├── voting/page.tsx             # Система голосования (описание, FAQ)
│   ├── voting/algorithm/page.tsx   # Калькулятор алгоритма голосования
│   ├── forum/
│   │   ├── layout.tsx              # ForumAuthProvider обёртка
│   │   ├── page.tsx                # Форум (список тем, создание вопроса)
│   │   └── [id]/page.tsx           # Тема + ответы + форма ответа
│   ├── resources/page.tsx          # Ресурсы и обучение
│   ├── admin/
│   │   ├── login/page.tsx          # Вход в админку
│   │   ├── page.tsx                # Дашборд (KPI, графики, последние заявки)
│   │   ├── applications/page.tsx   # Управление заявками (фильтры, CSV-экспорт)
│   │   ├── analytics/page.tsx      # Аналитика посещений
│   │   └── forum/page.tsx          # Модерация форума (одобрение, ответы, удаление)
│   └── api/
│       ├── admin/login/             # POST — вход (пароль → JWT-кука)
│       ├── admin/verify/            # GET — проверка сессии
│       ├── admin/logout/            # POST — выход
│       ├── admin/dashboard/         # GET — данные дашборда
│       ├── applications/            # GET — список, POST — новая заявка
│       ├── applications/[id]/       # GET — одна заявка
│       ├── forum/
│       │   ├── auth/login/          # POST — вход сотрудника (JWT-кука forum_token)
│       │   ├── auth/verify/         # GET — проверка сессии форума
│       │   ├── auth/logout/         # POST — выход
│       │   ├── topics/              # GET — список тем, POST — создать тему
│       │   ├── topics/[id]/         # GET — тема + ответы
│       │   └── replies/             # POST — написать ответ
│       ├── admin/forum/
│       │   ├── topics/              # GET — список тем для модерации
│       │   ├── topics/[id]/         # GET/PATCH/DELETE — детали/модерация/удаление темы
│       │   ├── replies/             # GET — pending ответы, POST — ответ модератора
│       │   └── replies/[id]/        # PATCH/DELETE — модерация/удаление ответа
│       ├── divisions/               # GET — список дивизионов
│       ├── stats/                   # GET — статистика для главной
│       └── analytics/               # GET/POST — аналитика посещений
├── components/
│   ├── Header.tsx                  # Навигация (7 пунктов + CTA)
│   ├── Footer.tsx                  # Подвал
│   ├── HeroCarousel.tsx            # Карусель на главной (5 слайдов, автоплей)
│   ├── StatsSection.tsx            # Блок статистики (20 дивизионов, 30 премий...)
│   ├── ApplicationForm.tsx         # Форма подачи заявки (многосекционная)
│   ├── ForumAuth.tsx               # Контекст авторизации форума + форма входа
│   └── Avatar.tsx                  # Аватар с инициалами
├── data/
│   └── testimonials.ts             # Истории, дивизионы, таймлайн конкурса
└── middleware.ts                    # Трекинг посещений страниц
```

## Админ-панель

### Вход

- **URL:** https://taipit.starec.ai/admin/login
- **Пароль:** `eai-hub-admin-2026`
- Сессия живёт 24 часа (JWT в httpOnly-куке)

### Возможности

| Раздел | Что делает |
|--------|------------|
| **Дашборд** (`/admin`) | KPI-карточки, графики заявок по дням/категориям/дивизионам, таблица последних заявок |
| **Заявки** (`/admin/applications`) | Список всех заявок с фильтрами (дивизион, категория, тип, статус), пагинация, CSV-экспорт, детальный просмотр |
| **Форум** (`/admin/forum`) | Модерация тем и ответов, ответ от имени модератора, удаление тем/ответов, закрепление тем |
| **Аналитика** (`/admin/analytics`) | Посещаемость за неделю/месяц/всё время, популярные страницы, уникальные посетители, CSV-экспорт |

## Форум

### Как работает

Форум позволяет сотрудникам задавать вопросы, а модератору — отвечать на них из админки.

**Для сотрудников** (https://taipit.starec.ai/forum):
- Авторизация: имя + email + дивизион (без пароля, JWT-кука `forum_token` на 7 дней)
- Создание вопроса: категория + заголовок + текст
- Премодерация: вопрос виден автору как "На модерации", остальным — после одобрения
- Ответы на темы других сотрудников (тоже с премодерацией)

**Для модератора** (https://taipit.starec.ai/admin/forum):
- Таб "На модерации": pending темы и ответы с кнопками Одобрить / Отклонить / Удалить
- Таб "Все темы": таблица всех тем с фильтром по статусу, закреплением, удалением
- Клик на тему → модалка с деталями, всеми ответами и формой ответа модератора
- Ответ модератора автоматически публикуется + одобряет тему

### Авторизация форума

| Кука | Назначение | Срок |
|------|-----------|------|
| `forum_token` | JWT для сотрудников на форуме | 7 дней |
| `admin_token` | JWT для админ-панели | 24 часа |

## Локальная разработка

### Требования

- Node.js 20+
- npm

### Запуск

```bash
# Клонировать репозиторий
git clone https://github.com/Viktor-admin-dev/taipit-eai-hub.git
cd taipit-eai-hub

# Установить зависимости
npm install

# Создать базу данных
npx prisma db push

# (Опционально) Заполнить тестовыми данными
npm run db:seed

# Запустить dev-сервер
npm run dev
```

Сайт будет доступен на http://localhost:3000

### Переменные окружения

Создайте файл `.env.local`:

```env
DATABASE_URL="file:./prisma/dev.db"
ADMIN_PASSWORD="eai-hub-admin-2026"
JWT_SECRET="taipit-eai-hub-secret-key-2026"
```

### Полезные команды

```bash
npm run dev          # Dev-сервер с hot reload
npm run build        # Продакшен-сборка
npm run start        # Запуск продакшен-сборки
npm run lint         # Проверка кода (ESLint)
npm run db:push      # Применить схему к БД
npm run db:seed      # Заполнить БД тестовыми данными
npm run db:studio    # Открыть Prisma Studio (GUI для БД)
```

## Деплой на продакшен

### Как устроен деплой

Приложение работает в Docker-контейнере на сервере Hetzner (136.243.71.213):

- **Docker** собирает оптимизированный образ (multi-stage build, Node 20)
- **Контейнер** `taipit-eai-hub` слушает порт 3010
- **Nginx** проксирует `taipit.starec.ai` → `localhost:3010`
- **Cloudflare** обеспечивает DNS и CDN
- **SSL** через Let's Encrypt

### Внесение изменений

```bash
# 1. Внести изменения в код локально

# 2. Закоммитить и запушить в GitHub
git add .
git commit -m "описание изменений"
git push origin main

# 3. Подключиться к серверу
ssh root@136.243.71.213 -i ~/.ssh/id_ed25519

# 4. Обновить код и пересобрать контейнер
cd /root/taipit-eai-hub
git pull
docker compose up -d --build

# 5. Проверить что контейнер запустился
docker ps | grep taipit
```

### Быстрый деплой одной командой

```bash
ssh root@136.243.71.213 "cd /root/taipit-eai-hub && git pull && docker compose up -d --build"
```

### Логи контейнера

```bash
# Последние логи
ssh root@136.243.71.213 "docker logs taipit-eai-hub --tail 50"

# Логи в реальном времени
ssh root@136.243.71.213 "docker logs taipit-eai-hub -f"

# Логи nginx
ssh root@136.243.71.213 "tail -50 /var/log/nginx/taipit-access.log"
```

## База данных

SQLite-файл хранится внутри контейнера по пути `/app/prisma/dev.db`.

### Модели

| Модель | Описание |
|--------|----------|
| `Division` | 20 дивизионов холдинга |
| `User` | Сотрудники (employee, leader, moderator, admin) |
| `Application` | Заявки на конкурс (идея/прототип/внедрение) |
| `TeamMember` | Участники команды для групповых заявок |
| `Vote` | Голоса за заявки |
| `StatusChange` | История изменений статусов заявок |
| `Testimonial` | Истории успеха |
| `ForumTopic` / `ForumReply` | Форум |
| `PageVisit` / `DailyStat` | Аналитика посещений |

### Категории заявок

- `efficiency` — Оптимизация процессов
- `new_process` — Новый процесс
- `new_product` — Новый продукт
- `new_feature` — Новая функция
- `analytics` — Аналитика
- `content` — Контент

### Статусы заявок

`submitted` → `reviewing` → `finalist` → `winner` / `rejected`

## Призовой фонд

| Место | Сумма | Количество |
|-------|-------|------------|
| 1 место | 150 000 руб. | 5 премий |
| 2 место | 100 000 руб. | 10 премий |
| 3 место | 50 000 руб. | 15 премий |
| **Итого** | | **30 премий** |

## Важные файлы

| Файл | Что менять |
|------|-----------|
| `src/app/contest/page.tsx` | Этапы, призы, условия конкурса |
| `src/components/StatsSection.tsx` | Числа на главной (дивизионы, премии) и тултип |
| `src/components/HeroCarousel.tsx` | Слайды на главной |
| `src/data/testimonials.ts` | Истории успеха, список дивизионов, таймлайн |
| `src/app/why/page.tsx` | Письмо акционера, причины участвовать |
| `src/components/ForumAuth.tsx` | Контекст + форма авторизации форума |
| `src/app/admin/forum/page.tsx` | Админка форума (модерация, ответы, удаление) |
| `prisma/schema.prisma` | Схема базы данных |
| `prisma/seed.ts` | Сид данных (дивизионы, testimonials, модератор) |
| `Dockerfile` | Настройки сборки, переменные окружения |
| `docker-compose.yml` | Порт, настройки контейнера |
